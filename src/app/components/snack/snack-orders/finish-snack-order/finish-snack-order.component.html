<div class="finish-page">

  <mat-card class="order-card">
    <!-- Cabeçalho -->
    <div class="order-head">
      <div class="head-left">
        <mat-icon>receipt_long</mat-icon>
        <div class="title">
          <div class="title-main">Finalizar Pedido</div>
          <div class="title-sub">#{{ pedido }}</div>
        </div>
      </div>
      <div class="head-right">
        <span class="badge" [ngClass]="status === 'Concluído' ? 'success' : 'warn'">
          {{ status || 'Pendente' }}
        </span>
      </div>
    </div>

    <div class="order-body">
      <!-- Coluna: tabela de itens -->
      <div class="col items-col">
        <div class="table-wrap">
          <table class="table-modern">
            <thead>
              <tr>
                <th>Item</th>
                <th class="col-num">Qtd</th>
                <th>Obs.</th>
                <th class="col-num">Subtotal</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let it of detailOder">
                <td class="truncate">{{ it?.name }}</td>
                <td class="col-num mono">{{ it?.total_quantity }}</td>
                <td class="truncate">{{ it?.observation }}</td>
                <td class="col-num mono">R$ {{ it?.total }}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- loading local da lista -->
        <div class="loading-inline" *ngIf="isLoad">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
      </div>

      <!-- Coluna: resumo e pagamento -->
      <div class="col side-col">
        <!-- Resumo -->
        <div class="summary">
          <div class="summary-row">
            <span class="label">Cliente</span>
            <span class="value">{{ client }}</span>
          </div>
          <div class="summary-row">
            <span class="label">Atendimento</span>
            <span class="chip">{{ service_type }}</span>
          </div>
          <div class="summary-row">
            <span class="label">Pagamento</span>
            <span class="chip">{{ payment_type }}</span>
          </div>
          <div class="summary-row">
            <span class="label">Pago</span>
            <span class="value mono">R$ {{ pago | number:'1.2-2' }}</span>
          </div>
          <div class="summary-row total">
            <span class="label">Total do pedido</span>
            <span class="value strong mono">R$ {{ total_order | number:'1.2-2' }}</span>
          </div>
          <div class="summary-row" [ngClass]="(restante ?? 0) <= 0 ? 'ok' : 'warn'">
            <span class="label">Restante</span>
            <span class="value mono">R$ {{ restante | number:'1.2-2' }}</span>
          </div>
        </div>

        <!-- Form de pagamento (ligado ao FinishOrder) -->
        <div class="pay-card">
          <div class="pay-head">
            <mat-icon>payments</mat-icon>
            <span>Registrar Pagamento</span>
          </div>

          <div class="pay-form">
            <mat-form-field appearance="outline">
              <mat-label>Forma de pagamento</mat-label>
              <mat-select name="discounted_type" [(ngModel)]="FinishOrder.discounted_type">
                <mat-option value="Pix">Pix</mat-option>
                <mat-option value="Dinheiro">Dinheiro</mat-option>
                <mat-option value="Cartão">Cartão</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Valor recebido</mat-label>
              <input matInput type="number" step="0.01" name="discounted_value"
                     [(ngModel)]="FinishOrder.discounted_value" placeholder="0,00" />
            </mat-form-field>

            <button mat-raised-button class="button-success w-full"
                    (click)="finishOrderSnack()">
              Aplicar pagamento
              <mat-icon>check_small</mat-icon>
            </button>
          </div>
          <span class="hint">Se houver troco, o sistema exibirá um alerta.</span>
        </div>
      </div>
    </div>
  </mat-card>

</div>
